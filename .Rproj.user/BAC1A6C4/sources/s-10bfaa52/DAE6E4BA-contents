data <- read.csv("transparencia.csv")
colnames(data)

library(ggplot2)
library(plotly)


# Agencia A~o
year_amount = aggregate(amount~fiscal_year+department, data, sum)
year_amount$amount = year_amount$amount/1e6

p <- ggplot(data = year_amount) +
  geom_line(mapping = aes(x = fiscal_year, y = amount, colour = department)) +
  labs(x = "Año Fiscal",
       y = "Cantidad en Millones de $",
       title = "Gasto Agencial Anual", 
       colour = "Agencia")

p <- ggplotly(p)
p

# Agencia Mes
month_amount = aggregate(amount~fiscal_year_period+department+fiscal_year, data, sum)
month_amount$amount = month_amount$amount/1e6
month_amount$dates <- paste0(month_amount$fiscal_year, "/", month_amount$fiscal_year_period, "/1")

month_amount$dates <- as.Date(month_amount$dates)

p <- ggplot(data = month_amount) +
  geom_line(mapping = aes(x = month_amount$dates, y = amount, colour = department)) +
  labs(x = "Mes del Año Fiscal", 
       y = "Cantidad en Millones de $",
       title = "Gasto Agencial Cumulativo Mensual",
       colour = "Agencia")

p <- ggplotly(p)
p

# Agencia Agencia

# todos los años
agency_amount = aggregate(amount~department, data, sum)
agency_amount$amount = agency_amount$amount/1e6

p <- ggplot(data = agency_amount) + 
  geom_bar(mapping = aes(x = department, y = amount, fill = department), stat = "identity") + 
  labs(x = "Agencia",
       y = "Cantidad en Millones de $",
       title = "Gasto Agencial Total",
       fill = "Agencia")

p <- ggplotly(p)
p

# Por Año
agency_amount = aggregate(amount~department+fiscal_year, data, sum)
agency_amount$amount = agency_amount$amount/1e6
agency_amount = agency_amount[agency_amount$fiscal_year == 2017, ]


p <- ggplot(data = agency_amount) + 
  geom_bar(mapping = aes(x = department, y = amount, fill = department), stat = "identity") + 
  labs(x = "Agencia",
       y = "Cantidad en Millones de $",
       title = paste0("Gasto Agencial Total en ", 2017),
       fill = "Agencia")

p <- ggplotly(p)
p

month_amount$qtr <- numeric(length(month_amount$fiscal_year_period))
# Agencia por Qtr
for (i in 1:length(month_amount$fiscal_year_period)){
  if (month_amount$fiscal_year_period[i] >= 1 && month_amount$fiscal_year_period[i] <= 3){
    month_amount$qtr[i] = paste0(month_amount$fiscal_year[i], "-1")
  } else if (month_amount$fiscal_year_period[i] >= 4 && month_amount$fiscal_year_period[i] <= 6){
    month_amount$qtr[i] = paste0(month_amount$fiscal_year[i], "-2")
  } else if (month_amount$fiscal_year_period[i] >= 7 && month_amount$fiscal_year_period[i] <= 9){
    month_amount$qtr[i] = paste0(month_amount$fiscal_year[i], "-3")
  } else if (month_amount$fiscal_year_period[i] >= 10 && month_amount$fiscal_year_period[i] <= 12){
    month_amount$qtr[i] = paste0(month_amount$fiscal_year[i], "-4")
  }
}

qtr_amount = aggregate(amount~qtr+department, month_amount, sum)

p <- ggplot(data = qtr_amount) +
  geom_line(mapping = aes(x = qtr, y = amount, colour = department, group = 1)) +
  labs(x = "Mes del Año Fiscal", 
       y = "Cantidad en Millones de $",
       title = "Gasto Agencial Cumulativo Mensual",
       colour = "Agencia")

p <- ggplotly(p)
p